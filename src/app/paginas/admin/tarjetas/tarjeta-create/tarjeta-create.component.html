<div class="container mx-auto px-4 py-8">
  <div class="bg-white rounded-lg shadow-md p-6">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-800">Crear Nueva Tarjeta Digital</h1>
      <button
        type="button"
        (click)="cancelar()"
        class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md flex items-center transition-colors"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M10 19l-7-7m0 0l7-7m-7 7h18"
          />
        </svg>
        Volver
      </button>
    </div>

    <!-- Progress Steps -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <div *ngFor="let step of [1,2,3,4]; let i = index" class="flex items-center">
          <div class="flex items-center">
            <div
              class="flex items-center justify-center w-10 h-10 rounded-full text-white font-medium transition-colors"
              [ngClass]="{
                'bg-blue-600': currentStep === step,
                'bg-green-500': isStepCompleted(step) && currentStep !== step,
                'bg-gray-300': !isStepCompleted(step) && currentStep !== step
              }"
            >
              <span *ngIf="!isStepCompleted(step) || currentStep === step">{{ step }}</span>
              <svg *ngIf="isStepCompleted(step) && currentStep !== step" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div class="ml-3 hidden sm:block">
              <p class="text-sm font-medium" [ngClass]="{
                'text-blue-600': currentStep === step,
                'text-green-600': isStepCompleted(step) && currentStep !== step,
                'text-gray-500': !isStepCompleted(step) && currentStep !== step
              }">
                {{ getStepTitle(step) }}
              </p>
            </div>
          </div>
          <div *ngIf="i < 3" class="hidden md:block w-20 h-1 mx-4 rounded-full"
               [ngClass]="{
                 'bg-green-500': isStepCompleted(step),
                 'bg-gray-300': !isStepCompleted(step)
               }">
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje de éxito -->
    <div
      *ngIf="successMessage()"
      class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"
    >
      <div class="flex">
        <svg
          class="h-6 w-6 text-green-500 mr-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 13l4 4L19 7"
          />
        </svg>
        <span>{{ successMessage() }}</span>
      </div>
    </div>

    <!-- Mensaje de error -->
    <div
      *ngIf="errorMessage()"
      class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"
    >
      <div class="flex">
        <svg
          class="h-6 w-6 text-red-500 mr-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <span>{{ errorMessage() }}</span>
      </div>
    </div>

    <form [formGroup]="tarjetaForm" (ngSubmit)="onSubmit()">
      
      <!-- Paso 1: Información Personal -->
      <div *ngIf="currentStep === 1" class="space-y-6" formGroupName="personalInfo">
        <div class="border-b border-gray-200 pb-4 mb-6">
          <h2 class="text-lg font-semibold text-gray-800">Información Personal</h2>
          <p class="text-sm text-gray-600">Información básica de la tarjeta digital</p>
        </div>

        <!-- Nombre -->
        <div class="space-y-2">
          <label for="name" class="block text-sm font-medium text-gray-700">
            Nombre Completo <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="name"
            formControlName="name"
            placeholder="Ej: Juan Carlos Pérez"
            class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{
              'border-red-500': esInvalido('personalInfo', 'name'),
              'border-gray-300': !esInvalido('personalInfo', 'name')
            }"
          />
          <div *ngIf="esInvalido('personalInfo', 'name')" class="text-sm text-red-600 mt-1">
            <p *ngFor="let error of obtenerErrores('personalInfo', 'name')">{{ error }}</p>
          </div>
        </div>

        <!-- Título/Cargo -->
        <div class="space-y-2">
          <label for="title" class="block text-sm font-medium text-gray-700">
            Título o Cargo
          </label>
          <input
            type="text"
            id="title"
            formControlName="title"
            placeholder="Ej: Desarrollador Full Stack, CEO, Designer"
            class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{
              'border-red-500': esInvalido('personalInfo', 'title'),
              'border-gray-300': !esInvalido('personalInfo', 'title')
            }"
          />
          <div *ngIf="esInvalido('personalInfo', 'title')" class="text-sm text-red-600 mt-1">
            <p *ngFor="let error of obtenerErrores('personalInfo', 'title')">{{ error }}</p>
          </div>
        </div>

        <!-- Ubicación -->
        <div class="space-y-2">
          <label for="location" class="block text-sm font-medium text-gray-700">
            Ubicación
          </label>
          <input
            type="text"
            id="location"
            formControlName="location"
            placeholder="Ej: Madrid, España"
            class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{
              'border-red-500': esInvalido('personalInfo', 'location'),
              'border-gray-300': !esInvalido('personalInfo', 'location')
            }"
          />
          <div *ngIf="esInvalido('personalInfo', 'location')" class="text-sm text-red-600 mt-1">
            <p *ngFor="let error of obtenerErrores('personalInfo', 'location')">{{ error }}</p>
          </div>
        </div>

        <!-- Foto de perfil -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Foto de Perfil</label>
          <div class="flex items-center space-x-4">
            <!-- Preview de imagen -->
            <div class="flex-shrink-0">
              <div class="w-20 h-20 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center">
                <img 
                  *ngIf="previewImagen" 
                  [src]="previewImagen" 
                  alt="Preview" 
                  class="w-full h-full object-cover"
                />
                <svg 
                  *ngIf="!previewImagen"
                  class="w-8 h-8 text-gray-400" 
                  fill="currentColor" 
                  viewBox="0 0 20 20"
                >
                  <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                </svg>
              </div>
            </div>
            <!-- Input de archivo -->
            <div>
              <input
                type="file"
                id="photo"
                accept="image/*"
                (change)="onFileChange($event)"
                class="hidden"
              />
              <label
                for="photo"
                class="bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm leading-4 font-medium text-gray-700 hover:bg-gray-50 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500 cursor-pointer"
              >
                Seleccionar imagen
              </label>
              <p class="text-xs text-gray-500 mt-1">PNG, JPG hasta 2MB</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Paso 2: Información de Contacto -->
      <div *ngIf="currentStep === 2" class="space-y-6" formGroupName="contact">
        <div class="border-b border-gray-200 pb-4 mb-6">
          <h2 class="text-lg font-semibold text-gray-800">Información de Contacto</h2>
          <p class="text-sm text-gray-600">Agrega tus métodos de contacto y redes sociales</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Email -->
          <div class="space-y-2">
            <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
            <input
              type="email"
              id="email"
              formControlName="email"
              placeholder="ejemplo@correo.com"
              class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              [ngClass]="{
                'border-red-500': esInvalido('contact', 'email'),
                'border-gray-300': !esInvalido('contact', 'email')
              }"
            />
            <div *ngIf="esInvalido('contact', 'email')" class="text-sm text-red-600 mt-1">
              <p *ngFor="let error of obtenerErrores('contact', 'email')">{{ error }}</p>
            </div>
          </div>

          <!-- Teléfono -->
          <div class="space-y-2">
            <label for="phone" class="block text-sm font-medium text-gray-700">Teléfono</label>
            <input
              type="tel"
              id="phone"
              formControlName="phone"
              placeholder="+34 123 456 789"
              class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              [ngClass]="{
                'border-red-500': esInvalido('contact', 'phone'),
                'border-gray-300': !esInvalido('contact', 'phone')
              }"
            />
            <div *ngIf="esInvalido('contact', 'phone')" class="text-sm text-red-600 mt-1">
              <p *ngFor="let error of obtenerErrores('contact', 'phone')">{{ error }}</p>
            </div>
          </div>

          <!-- Website -->
          <div class="space-y-2">
            <label for="website" class="block text-sm font-medium text-gray-700">Sitio Web</label>
            <input
              type="url"
              id="website"
              formControlName="website"
              placeholder="https://misitio.com"
              class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              [ngClass]="{
                'border-red-500': esInvalido('contact', 'website'),
                'border-gray-300': !esInvalido('contact', 'website')
              }"
            />
            <div *ngIf="esInvalido('contact', 'website')" class="text-sm text-red-600 mt-1">
              <p *ngFor="let error of obtenerErrores('contact', 'website')">{{ error }}</p>
            </div>
          </div>

          <!-- WhatsApp -->
          <div class="space-y-2">
            <label for="whatsapp" class="block text-sm font-medium text-gray-700">WhatsApp</label>
            <input
              type="tel"
              id="whatsapp"
              formControlName="whatsapp"
              placeholder="+34 123 456 789"
              class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              [ngClass]="{
                'border-red-500': esInvalido('contact', 'whatsapp'),
                'border-gray-300': !esInvalido('contact', 'whatsapp')
              }"
            />
            <div *ngIf="esInvalido('contact', 'whatsapp')" class="text-sm text-red-600 mt-1">
              <p *ngFor="let error of obtenerErrores('contact', 'whatsapp')">{{ error }}</p>
            </div>
          </div>

          <!-- LinkedIn -->
          <div class="space-y-2">
            <label for="linkedin" class="block text-sm font-medium text-gray-700">LinkedIn</label>
            <input
              type="url"
              id="linkedin"
              formControlName="linkedin"
              placeholder="https://linkedin.com/in/usuario"
              class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              [ngClass]="{
                'border-red-500': esInvalido('contact', 'linkedin'),
                'border-gray-300': !esInvalido('contact', 'linkedin')
              }"
            />
            <div *ngIf="esInvalido('contact', 'linkedin')" class="text-sm text-red-600 mt-1">
              <p *ngFor="let error of obtenerErrores('contact', 'linkedin')">{{ error }}</p>
            </div>
          </div>

          <!-- Twitter -->
          <div class="space-y-2">
            <label for="twitter" class="block text-sm font-medium text-gray-700">Twitter</label>
            <input
              type="url"
              id="twitter"
              formControlName="twitter"
              placeholder="https://twitter.com/usuario"
              class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              [ngClass]="{
                'border-red-500': esInvalido('contact', 'twitter'),
                'border-gray-300': !esInvalido('contact', 'twitter')
              }"
            />
            <div *ngIf="esInvalido('contact', 'twitter')" class="text-sm text-red-600 mt-1">
              <p *ngFor="let error of obtenerErrores('contact', 'twitter')">{{ error }}</p>
            </div>
          </div>

          <!-- Instagram -->
          <div class="space-y-2">
            <label for="instagram" class="block text-sm font-medium text-gray-700">Instagram</label>
            <input
              type="url"
              id="instagram"
              formControlName="instagram"
              placeholder="https://instagram.com/usuario"
              class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              [ngClass]="{
                'border-red-500': esInvalido('contact', 'instagram'),
                'border-gray-300': !esInvalido('contact', 'instagram')
              }"
            />
            <div *ngIf="esInvalido('contact', 'instagram')" class="text-sm text-red-600 mt-1">
              <p *ngFor="let error of obtenerErrores('contact', 'instagram')">{{ error }}</p>
            </div>
          </div>

          <!-- GitHub -->
          <div class="space-y-2">
            <label for="github" class="block text-sm font-medium text-gray-700">GitHub</label>
            <input
              type="url"
              id="github"
              formControlName="github"
              placeholder="https://github.com/usuario"
              class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              [ngClass]="{
                'border-red-500': esInvalido('contact', 'github'),
                'border-gray-300': !esInvalido('contact', 'github')
              }"
            />
            <div *ngIf="esInvalido('contact', 'github')" class="text-sm text-red-600 mt-1">
              <p *ngFor="let error of obtenerErrores('contact', 'github')">{{ error }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Paso 3: Acerca de -->
      <div *ngIf="currentStep === 3" class="space-y-6" formGroupName="about">
        <div class="border-b border-gray-200 pb-4 mb-6">
          <h2 class="text-lg font-semibold text-gray-800">Acerca de</h2>
          <p class="text-sm text-gray-600">Información adicional sobre tu perfil profesional</p>
        </div>

        <!-- Descripción -->
        <div class="space-y-2">
          <label for="description" class="block text-sm font-medium text-gray-700">Descripción</label>
          <textarea
            id="description"
            formControlName="description"
            rows="4"
            placeholder="Describe brevemente tu experiencia, objetivos o lo que te define profesionalmente..."
            class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{
              'border-red-500': esInvalido('about', 'description'),
              'border-gray-300': !esInvalido('about', 'description')
            }"
          ></textarea>
          <div *ngIf="esInvalido('about', 'description')" class="text-sm text-red-600 mt-1">
            <p *ngFor="let error of obtenerErrores('about', 'description')">{{ error }}</p>
          </div>
        </div>

        <!-- Habilidades -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Habilidades</label>
          <div class="space-y-3" formArrayName="skills">
            <div *ngFor="let skill of skillsArray.controls; let i = index" class="flex items-center space-x-2">
              <input
                type="text"
                [formControlName]="i"
                placeholder="Ej: JavaScript, Design Thinking, Marketing Digital"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <button
                type="button"
                (click)="removeSkill(i)"
                class="flex-shrink-0 w-8 h-8 bg-red-100 text-red-600 rounded-full hover:bg-red-200 flex items-center justify-center"
              >
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                </svg>
              </button>
            </div>
            <button
              type="button"
              (click)="addSkill()"
              class="flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors"
            >
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
              </svg>
              <span>Agregar habilidad</span>
            </button>
          </div>
        </div>

        <!-- Experiencia -->
        <div class="space-y-2">
          <label for="experience" class="block text-sm font-medium text-gray-700">Años de Experiencia</label>
          <input
            type="number"
            id="experience"
            formControlName="experience"
            min="0"
            max="50"
            placeholder="0"
            class="w-32 px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            [ngClass]="{
              'border-red-500': esInvalido('about', 'experience'),
              'border-gray-300': !esInvalido('about', 'experience')
            }"
          />
          <div *ngIf="esInvalido('about', 'experience')" class="text-sm text-red-600 mt-1">
            <p *ngFor="let error of obtenerErrores('about', 'experience')">{{ error }}</p>
          </div>
        </div>
      </div>

      <!-- Paso 4: Configuración -->
      <div *ngIf="currentStep === 4" class="space-y-6" formGroupName="settings">
        <div class="border-b border-gray-200 pb-4 mb-6">
          <h2 class="text-lg font-semibold text-gray-800">Configuración</h2>
          <p class="text-sm text-gray-600">Configura la visibilidad y estado de tu tarjeta digital</p>
        </div>

        <div class="space-y-4">
          <!-- Estado Activo -->
          <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div>
              <h3 class="text-sm font-medium text-gray-900">Estado Activo</h3>
              <p class="text-sm text-gray-500">La tarjeta está activa y funcional</p>
            </div>
            <label class="inline-flex items-center cursor-pointer">
              <input
                type="checkbox"
                class="sr-only peer"
                formControlName="is_active"
              />
              <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
            </label>
          </div>

          <!-- Visibilidad Pública -->
          <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div>
              <h3 class="text-sm font-medium text-gray-900">Visibilidad Pública</h3>
              <p class="text-sm text-gray-500">La tarjeta será visible públicamente</p>
            </div>
            <label class="inline-flex items-center cursor-pointer">
              <input
                type="checkbox"
                class="sr-only peer"
                formControlName="is_public"
              />
              <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
            </label>
          </div>
        </div>
      </div>

      <!-- Botones de navegación -->
      <div class="flex justify-between items-center pt-6 border-t border-gray-200">
        <button
          type="button"
          (click)="previousStep()"
          [disabled]="currentStep === 1"
          class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Anterior
        </button>

        <div class="flex space-x-3">
          <button
            *ngIf="currentStep < totalSteps"
            type="button"
            (click)="nextStep()"
            class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
          >
            Siguiente
          </button>

          <button
            *ngIf="currentStep === totalSteps"
            type="submit"
            [disabled]="isLoading()"
            class="px-6 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span *ngIf="!isLoading()">Crear Tarjeta</span>
            <span *ngIf="isLoading()" class="flex items-center">
              <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Creando...
            </span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>